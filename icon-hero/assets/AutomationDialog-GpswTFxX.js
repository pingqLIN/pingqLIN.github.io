import{r as t,p as b,j as e,n as V,B as A,a as p,m as L,S as _,s as v,t as h}from"./index-CadvBdgV.js";import{T as H,a as C,b as c,m as W,s as k,c as O,L as m,F as D}from"./FolderPathInput-CBFuXsQf.js";import{D as M,a as T,b as Z,c as R,d as z}from"./dialog-BDfz3aQ2.js";const U=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,28H88A12,12,0,0,0,76,40V76H40A12,12,0,0,0,28,88V216a12,12,0,0,0,12,12H168a12,12,0,0,0,12-12V180h36a12,12,0,0,0,12-12V40A12,12,0,0,0,216,28ZM156,204H52V100H156Zm48-48H180V88a12,12,0,0,0-12-12H100V52H204Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,40V168H168V88H88V40Z",opacity:"0.2"}),t.createElement("path",{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32Zm-8,128H176V88a8,8,0,0,0-8-8H96V48H208Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,34H88a6,6,0,0,0-6,6V82H40a6,6,0,0,0-6,6V216a6,6,0,0,0,6,6H168a6,6,0,0,0,6-6V174h42a6,6,0,0,0,6-6V40A6,6,0,0,0,216,34ZM162,210H46V94H162Zm48-48H174V88a6,6,0,0,0-6-6H94V46H210Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,36H88a4,4,0,0,0-4,4V84H40a4,4,0,0,0-4,4V216a4,4,0,0,0,4,4H168a4,4,0,0,0,4-4V172h44a4,4,0,0,0,4-4V40A4,4,0,0,0,216,36ZM164,212H44V92H164Zm48-48H172V88a4,4,0,0,0-4-4H92V44H212Z"}))]]),K=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M234.49,111.07,90.41,22.94A20,20,0,0,0,60,39.87V216.13a20,20,0,0,0,30.41,16.93l144.08-88.13a19.82,19.82,0,0,0,0-33.86ZM84,208.85V47.15L216.16,128Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M228.23,134.69,84.15,222.81A8,8,0,0,1,72,216.12V39.88a8,8,0,0,1,12.15-6.69l144.08,88.12A7.82,7.82,0,0,1,228.23,134.69Z",opacity:"0.2"}),t.createElement("path",{d:"M232.4,114.49,88.32,26.35a16,16,0,0,0-16.2-.3A15.86,15.86,0,0,0,64,39.87V216.13A15.94,15.94,0,0,0,80,232a16.07,16.07,0,0,0,8.36-2.35L232.4,141.51a15.81,15.81,0,0,0,0-27ZM80,215.94V40l143.83,88Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M231.36,116.19,87.28,28.06a14,14,0,0,0-14.18-.27A13.69,13.69,0,0,0,66,39.87V216.13a13.69,13.69,0,0,0,7.1,12.08,14,14,0,0,0,14.18-.27l144.08-88.13a13.82,13.82,0,0,0,0-23.62Zm-6.26,13.38L81,217.7a2,2,0,0,1-2.06,0,1.78,1.78,0,0,1-1-1.61V39.87a1.78,1.78,0,0,1,1-1.61A2.06,2.06,0,0,1,80,38a2,2,0,0,1,1,.31L225.1,126.43a1.82,1.82,0,0,1,0,3.14Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M232.4,114.49,88.32,26.35a16,16,0,0,0-16.2-.3A15.86,15.86,0,0,0,64,39.87V216.13A15.94,15.94,0,0,0,80,232a16.07,16.07,0,0,0,8.36-2.35L232.4,141.51a15.81,15.81,0,0,0,0-27ZM80,215.94V40l143.83,88Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M230.32,117.9,86.24,29.79a11.91,11.91,0,0,0-12.17-.23A11.71,11.71,0,0,0,68,39.89V216.11a11.71,11.71,0,0,0,6.07,10.33,11.91,11.91,0,0,0,12.17-.23L230.32,138.1a11.82,11.82,0,0,0,0-20.2Zm-4.18,13.37L82.06,219.39a4,4,0,0,1-4.07.07,3.77,3.77,0,0,1-2-3.35V39.89a3.77,3.77,0,0,1,2-3.35,4,4,0,0,1,4.07.07l144.08,88.12a3.8,3.8,0,0,1,0,6.54Z"}))]]),F=t.forwardRef((a,n)=>t.createElement(b,{ref:n,...a,weights:U}));F.displayName="CopyIcon";const q=F,P=t.forwardRef((a,n)=>t.createElement(b,{ref:n,...a,weights:K}));P.displayName="PlayIcon";const G=P;function Y(a){const n=a.targetPaths.map(r=>r.replace(/\\/g,"\\\\")),s=a.iconPath.replace(/\\/g,"\\\\");return`# Windows 圖示自動化腳本
# 生成時間: ${new Date().toLocaleString("zh-TW")}

# ---------- 工具函數 ----------

# 正規化路徑：展開環境變數、去尾斜線、正斜線轉反斜線
function Normalize-FolderPath {
    param([string]$RawPath)
    $expanded = [System.Environment]::ExpandEnvironmentVariables($RawPath)
    $expanded = $expanded.Replace('/', '\\\\')
    $expanded = $expanded.TrimEnd('\\\\')
    if ($expanded -match '^[A-Za-z]:$') { $expanded += '\\\\' }
    return $expanded
}

# 模糊搜尋
function Find-SimilarFolder {
    param([string]$TargetPath)
    $parentDir = Split-Path -Parent $TargetPath
    $folderName = Split-Path -Leaf $TargetPath
    if (-not (Test-Path $parentDir)) { return $null }
    
    $exact = Get-ChildItem -Path $parentDir -Directory -ErrorAction SilentlyContinue |
        Where-Object { $_.Name -ieq $folderName } | Select-Object -First 1
    if ($exact) { return $exact.FullName }
    
    $keyword = $folderName -replace '[-_\\s]+', '*'
    $partial = Get-ChildItem -Path $parentDir -Directory -ErrorAction SilentlyContinue |
        Where-Object { $_.Name -ilike "*$keyword*" } | Select-Object -First 5
    if ($partial) { return $partial }
    return $null
}

# ---------- 主程式 ----------

$iconPath = "${s}"
$rawFolders = @(
${n.map(r=>`    "${r}"`).join(`,
`)}
)

Write-Host "開始套用圖示..."
Write-Host ""

$successCount = 0
$failCount = 0
$skipCount = 0

foreach ($rawPath in $rawFolders) {
    $folder = Normalize-FolderPath $rawPath
    if ($folder -ne $rawPath) {
        Write-Host "  [INFO] 路徑已正規化: $rawPath -> $folder" -ForegroundColor DarkGray
    }
    
    if (Test-Path $folder) {
        if (-not (Test-Path $folder -PathType Container)) {
            Write-Host "  [SKIP] 不是資料夾: $folder" -ForegroundColor Yellow
            $skipCount++
            continue
        }
        try {
            $desktopIni = Join-Path $folder "desktop.ini"
            if (Test-Path $desktopIni) { attrib -h -s $desktopIni 2>$null }
            @"
[.ShellClassInfo]
IconResource=$iconPath,0
"@ | Set-Content -Path $desktopIni -Encoding Unicode
            attrib +h +s $desktopIni
            attrib +s $folder
            Write-Host "  [OK] $folder" -ForegroundColor Green
            $successCount++
        } catch {
            Write-Host "  [FAIL] $folder - $($_.Exception.Message)" -ForegroundColor Red
            $failCount++
        }
    } else {
        Write-Host "  [WARN] 找不到: $folder" -ForegroundColor Yellow
        $similar = Find-SimilarFolder $folder
        if ($similar -is [System.IO.DirectoryInfo] -or $similar -is [string]) {
            $suggestedPath = if ($similar -is [string]) { $similar } else { $similar.FullName }
            Write-Host "         你是不是要找: $suggestedPath" -ForegroundColor DarkYellow
            Write-Host "         自動使用此路徑..." -ForegroundColor DarkYellow
            try {
                $desktopIni = Join-Path $suggestedPath "desktop.ini"
                if (Test-Path $desktopIni) { attrib -h -s $desktopIni 2>$null }
                @"
[.ShellClassInfo]
IconResource=$iconPath,0
"@ | Set-Content -Path $desktopIni -Encoding Unicode
                attrib +h +s $desktopIni
                attrib +s $suggestedPath
                Write-Host "  [OK] $suggestedPath (模糊比對)" -ForegroundColor Green
                $successCount++
            } catch {
                Write-Host "  [FAIL] $suggestedPath - $($_.Exception.Message)" -ForegroundColor Red
                $failCount++
            }
        } elseif ($similar -is [System.Array] -and $similar.Count -gt 0) {
            Write-Host "         找到類似資料夾：" -ForegroundColor DarkYellow
            foreach ($s in $similar) { Write-Host "           - $($s.FullName)" -ForegroundColor DarkYellow }
            $skipCount++
        } else {
            Write-Host "         上層目錄也不存在" -ForegroundColor Red
            $failCount++
        }
    }
}

Write-Host ""
Write-Host "完成！成功: $successCount / 跳過: $skipCount / 失敗: $failCount"
${a.isInlineMode?"":'Read-Host "按 Enter 鍵關閉"'}
`}function B(a){const n=a.iconPath.replace(/"/g,'\\"'),s=a.targetPaths.map(r=>r.replace(/"/g,'\\"'));return`#!/bin/bash
# macOS 圖示自動化腳本
# 生成時間: ${new Date().toLocaleString("zh-TW")}

normalize_path() {
    local raw="$1"
    if [[ "$raw" == ~* ]]; then raw="\${raw/#\\~/$HOME}"; fi
    raw="\${raw%/}"
    echo "$raw"
}

find_similar() {
    local target="$1" parent_dir folder_name found
    parent_dir="$(dirname "$target")"
    folder_name="$(basename "$target")"
    if [ ! -d "$parent_dir" ]; then return 1; fi
    found=$(find "$parent_dir" -maxdepth 1 -type d -iname "$folder_name" 2>/dev/null | head -1)
    if [ -n "$found" ]; then echo "$found"; return 0; fi
    found=$(find "$parent_dir" -maxdepth 1 -type d -iname "*$folder_name*" 2>/dev/null | head -5)
    if [ -n "$found" ]; then echo "$found"; return 2; fi
    return 1
}

apply_icon() {
    local folder="$1" icon="$2"
    if command -v fileicon &>/dev/null; then
        fileicon set "$folder" "$icon" 2>/dev/null
    else
        osascript -e "
            use framework \\"AppKit\\"
            set iconImage to current application's NSImage's alloc()'s initWithContentsOfFile:\\"$icon\\"
            current application's NSWorkspace's sharedWorkspace()'s setIcon:iconImage forFile:\\"$folder\\" options:0
        " 2>/dev/null
    fi
    return $?
}

ICON_PATH="${n}"
RAW_FOLDERS=(
${s.map(r=>`    "${r}"`).join(`
`)}
)

echo "開始套用圖示..."
echo ""
SUCCESS=0; FAIL=0; SKIP=0

for raw in "\${RAW_FOLDERS[@]}"; do
    folder=$(normalize_path "$raw")
    if [ "$folder" != "$raw" ]; then echo "  [INFO] 路徑已正規化: $raw -> $folder"; fi
    
    if [ -d "$folder" ]; then
        apply_icon "$folder" "$ICON_PATH"
        if [ $? -eq 0 ]; then echo "  [OK] $folder"; ((SUCCESS++))
        else echo "  [FAIL] $folder"; ((FAIL++)); fi
    else
        echo "  [WARN] 找不到: $folder"
        similar=$(find_similar "$folder"); ret=$?
        if [ $ret -eq 0 ] && [ -n "$similar" ]; then
            echo "         自動比對到: $similar"
            apply_icon "$similar" "$ICON_PATH"
            if [ $? -eq 0 ]; then echo "  [OK] $similar (模糊比對)"; ((SUCCESS++))
            else echo "  [FAIL] $similar"; ((FAIL++)); fi
        elif [ $ret -eq 2 ] && [ -n "$similar" ]; then
            echo "         找到類似資料夾："; echo "$similar" | while read -r l; do echo "           - $l"; done
            ((SKIP++))
        else echo "         上層目錄也不存在"; ((FAIL++)); fi
    fi
done

echo ""
echo "完成！成功: $SUCCESS / 跳過: $SKIP / 失敗: $FAIL"
read -p "按 Enter 鍵關閉"
`}function J(a){const n=a.targetPaths.map(r=>r.replace(/"/g,'\\"')),s=a.iconPath.replace(/"/g,'\\"');return`#!/bin/bash
# Linux 圖示自動化腳本
# 生成時間: ${new Date().toLocaleString("zh-TW")}

normalize_path() {
    local raw="$1"
    if [[ "$raw" == ~* ]]; then raw="\${raw/#\\~/$HOME}"; fi
    raw="\${raw%/}"
    echo "$raw"
}

find_similar() {
    local target="$1" parent_dir folder_name found
    parent_dir="$(dirname "$target")"
    folder_name="$(basename "$target")"
    if [ ! -d "$parent_dir" ]; then return 1; fi
    found=$(find "$parent_dir" -maxdepth 1 -type d -iname "$folder_name" 2>/dev/null | head -1)
    if [ -n "$found" ]; then echo "$found"; return 0; fi
    found=$(find "$parent_dir" -maxdepth 1 -type d -iname "*$folder_name*" 2>/dev/null | head -5)
    if [ -n "$found" ]; then echo "$found"; return 2; fi
    return 1
}

ICON_PATH="${s}"
RAW_FOLDERS=(
${n.map(r=>`    "${r}"`).join(`
`)}
)

# 檢查 gio
if ! command -v gio &>/dev/null; then
    echo "錯誤：找不到 gio，請安裝 gvfs"
    read -p "按 Enter 鍵關閉"; exit 1
fi

echo "開始套用圖示..."
echo ""
SUCCESS=0; FAIL=0; SKIP=0

for raw in "\${RAW_FOLDERS[@]}"; do
    folder=$(normalize_path "$raw")
    if [ "$folder" != "$raw" ]; then echo "  [INFO] 路徑已正規化: $raw -> $folder"; fi
    
    if [ -d "$folder" ]; then
        gio set "$folder" metadata::custom-icon "file://$ICON_PATH" 2>/dev/null
        if [ $? -eq 0 ]; then echo "  [OK] $folder"; ((SUCCESS++))
        else echo "  [FAIL] $folder"; ((FAIL++)); fi
    else
        echo "  [WARN] 找不到: $folder"
        similar=$(find_similar "$folder"); ret=$?
        if [ $ret -eq 0 ] && [ -n "$similar" ]; then
            echo "         自動比對到: $similar"
            gio set "$similar" metadata::custom-icon "file://$ICON_PATH" 2>/dev/null
            if [ $? -eq 0 ]; then echo "  [OK] $similar (模糊比對)"; ((SUCCESS++))
            else echo "  [FAIL] $similar"; ((FAIL++)); fi
        elif [ $ret -eq 2 ] && [ -n "$similar" ]; then
            echo "         找到類似資料夾："; echo "$similar" | while read -r l; do echo "           - $l"; done
            ((SKIP++))
        else echo "         上層目錄也不存在"; ((FAIL++)); fi
    fi
done

echo ""
echo "完成！成功: $SUCCESS / 跳過: $SKIP / 失敗: $FAIL"
read -p "按 Enter 鍵關閉"
`}function Q(a,n){switch(n){case"powershell":return Y(a);case"applescript":return B(a);case"bash":return J(a);default:throw new Error(`Unsupported script type: ${n}`)}}function X(a){switch(a){case"powershell":return"ps1";case"applescript":return"scpt";case"bash":return"sh";default:return"txt"}}function ee(a){switch(a){case"powershell":return`1. 右鍵點擊腳本檔案
2. 選擇「以 PowerShell 執行」
3. 如遇執行政策限制，請以管理員身分執行 PowerShell 並執行：Set-ExecutionPolicy RemoteSigned`;case"applescript":return`1. 雙擊腳本檔案執行
2. 或使用「腳本編輯器」開啟並執行
3. 首次執行可能需要授予「Finder」存取權限`;case"bash":return`1. 開啟終端機
2. 執行：chmod +x script.sh
3. 執行：./script.sh
4. 需要安裝 gvfs 套件（Ubuntu/Debian：sudo apt install gvfs）`;default:return"請參考對應作業系統的執行說明"}}function te(a,n){const s=new Blob([a],{type:"text/plain"}),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}const f=()=>{const a=navigator.userAgent.toLowerCase();return a.includes("win")?"powershell":a.includes("mac")?"applescript":"bash"},u=f();function se({item:a,open:n,onOpenChange:s}){const[r,o]=t.useState(()=>f()),[g,x]=t.useState("file"),[d,w]=t.useState([]),[i,S]=t.useState("");if(t.useEffect(()=>{n&&(o(f()),x("file"),w([]),S(""))},[n]),!a||a.status!=="completed")return null;const $=l=>{switch(l){case"powershell":return"ico";case"applescript":return"icns";case"bash":return"png"}},j=()=>{if(d.length===0){h.error("請至少新增一個目標路徑");return}const l=$(r),N=`/path/to/${a.name}.${l}`,y=Q({targetPaths:d,iconPath:N,isInlineMode:g==="inline"},r);S(y),h.success("腳本已生成")},E=()=>{i&&(navigator.clipboard.writeText(i),h.success("已複製到剪貼簿"))},I=()=>{if(i){const l=X(r);te(i,`${a.name}_automation.${l}`),h.success("腳本已下載")}};return e.jsx(M,{open:n,onOpenChange:s,children:e.jsxs(T,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(V,{size:24,weight:"bold",className:"text-primary"}),"自動化腳本生成器"]}),e.jsx(z,{children:"生成自動化腳本以批次套用圖示至多個資料夾或檔案"})]}),e.jsx(H,{value:r,onValueChange:l=>o(l),className:"w-full",children:e.jsxs(C,{className:"grid w-full grid-cols-3",children:[e.jsxs(c,{value:"powershell",className:"gap-2",children:[e.jsx(W,{size:16,weight:"fill"}),"Windows"]}),e.jsxs(c,{value:"applescript",className:"gap-2",children:[e.jsx(k,{size:16,weight:"fill"}),"macOS"]}),e.jsxs(c,{value:"bash",className:"gap-2",children:[e.jsx(O,{size:16,weight:"fill"}),"Linux"]})]})}),r!==u&&e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-yellow-500/10 border border-yellow-500/30 text-yellow-600 dark:text-yellow-400 text-xs flex items-center gap-2",children:[e.jsx("span",{children:"⚠️"}),e.jsxs("span",{children:["你目前使用的是 ",e.jsx("strong",{children:u==="powershell"?"Windows":u==="applescript"?"macOS":"Linux"}),"， 但選擇了 ",e.jsx("strong",{children:r==="powershell"?"Windows":r==="applescript"?"macOS":"Linux"})," 腳本。 此腳本無法在你目前的系統上直接執行。"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-sm font-semibold",children:"圖示檔案"}),e.jsxs(A,{variant:"secondary",className:"text-xs",children:["推薦: ",$(r).toUpperCase()]})]}),e.jsx("div",{className:"p-3 bg-secondary/20 rounded-lg border border-border",children:e.jsxs("p",{className:"text-sm font-mono text-muted-foreground",children:[a.name,".",$(r)]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-sm font-semibold",children:"目標路徑"}),e.jsx(D,{paths:d,onPathsChange:w,placeholder:r==="powershell"?"C:\\Users\\Username\\Documents\\Folder":r==="applescript"?"/Users/username/Documents/Folder":"/home/username/Documents/Folder"})]}),r==="powershell"&&e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-secondary/10 rounded-lg border border-border",children:[e.jsx(m,{className:"text-xs text-muted-foreground",children:"腳本格式"}),e.jsx(H,{value:g,onValueChange:l=>x(l),className:"h-auto",children:e.jsxs(C,{className:"h-8",children:[e.jsx(c,{value:"file",className:"text-xs h-7",children:"檔案執行"}),e.jsx(c,{value:"inline",className:"text-xs h-7",children:"複製貼上"})]})})]}),e.jsxs(p,{onClick:j,className:"w-full gap-2",disabled:d.length===0,type:"button",children:[e.jsx(G,{size:16,weight:"fill"}),"生成腳本"]}),i&&e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-2",children:[e.jsx(m,{className:"text-sm font-semibold",children:"生成的腳本"}),e.jsx(_,{className:"h-64 w-full rounded-lg border border-border bg-muted/30",children:e.jsx("pre",{className:"p-4 text-xs font-mono",children:e.jsx("code",{children:i})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:E,variant:"outline",className:"flex-1 gap-2",type:"button",children:[e.jsx(q,{size:16}),"複製腳本"]}),e.jsxs(p,{onClick:I,className:"flex-1 gap-2",type:"button",children:[e.jsx(v,{size:16}),"下載腳本"]})]}),e.jsxs("div",{className:"p-3 bg-accent/10 rounded-lg border border-accent/20",children:[e.jsx("p",{className:"text-xs font-semibold text-accent-foreground mb-1",children:"使用說明:"}),e.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",children:ee(r)})]})]})]})]})})}export{se as AutomationDialog};
